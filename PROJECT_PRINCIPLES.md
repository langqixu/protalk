# 🌱 Protalk 极简工作原则

> **目标**：在保证“不重复推送 & 快速迭代”的前提下，用最小复杂度交付业务价值。

## 1. 当下必需（MVP 守门员）

| # | 原则 | 目的 |
|---|------|------|
|1|数据唯一源：业务状态只写 **PostgreSQL** | 防止不一致 / 重复推送 |
|2|幂等推送：`pushReviewUpdate` 必须检查 `is_pushed`，成功即更新 | 避免重复消息 |
|3|单一入口：所有评论推送经 **PushQueue**；验证脚本加 `isVerification` 标记 | 消除多入口混乱 |
|4|自动回归：CI 跑 **单元+集成**，包含“重复推送”测试 | 防回归 |
|5|监控告警：1min 内消息 >30 条则告警 | 及时发现异常 |

> 任何代码改动 **必须** 通过以上 5 条，否则不得合并。

---

## 2. 渐进增强（记录即可，按需实施）

- 队列持久化：Redis / BullMQ
- staging 群：灰度验证环境
- Prometheus + Grafana：消息量、重复率可视化
- e2e 自动点击卡片测试（Playwright）

触发条件：
```
消息量 > 500/天  或  并发冲突频繁  或  运维需可视化
```

---

## 3. 工作流速写

1. 任务说明：30min 内写 **Task Note**（动机 + 验收标准）
2. 小 PR：≤ 400 行，功能/重构/格式化分开提
3. PR 合并 = 通过 “MVP 守门员” 流水线
4. 自动部署 → 10 分钟内人工验证 / 可自动回滚
