# 真实环境测试指南

## 🎯 测试目标

验证飞书机器人在真实群组环境中的功能表现，确保所有功能正常工作。

## 📋 测试清单

### 1. 基础消息测试

#### 1.1 普通消息测试
在群组中发送以下消息，观察机器人是否正常接收：
```
你好，机器人
测试消息
这是一条普通消息
```

**预期结果**：
- 机器人应该能接收到消息
- 服务器日志中应该有相应的记录

#### 1.2 特殊字符测试
```
测试特殊字符：!@#$%^&*()
测试中文：你好世界
测试数字：1234567890
测试表情：😀🎉🚀
```

### 2. 斜杠指令测试

#### 2.1 帮助指令
```
/help
```

**预期结果**：
- 机器人应该回复帮助信息
- 显示可用的指令列表

#### 2.2 状态查询指令
```
/status
```

**预期结果**：
- 机器人应该回复当前服务状态
- 显示连接状态、模式等信息

#### 2.3 回复指令测试
```
/reply 这是一条测试回复
/reply 感谢您的反馈，我们会继续改进
```

**预期结果**：
- 机器人应该处理回复指令
- 可能需要在特定评论上下文中使用

### 3. 消息回应测试

#### 3.1 点赞回应
对机器人的消息进行点赞操作

**预期结果**：
- 机器人应该能接收到回应事件
- 服务器日志中应该有相应记录

#### 3.2 其他回应
尝试其他类型的回应（如表情回应）

### 4. 用户事件测试

#### 4.1 新用户加入
让新用户加入群组

**预期结果**：
- 机器人应该能接收到用户创建事件
- 可能发送欢迎消息

#### 4.2 用户信息更新
更新用户信息

**预期结果**：
- 机器人应该能接收到用户更新事件

## 🔍 监控和调试

### 1. 实时日志监控
```bash
# 监控服务器日志
tail -f logs/combined.log
```

### 2. 服务状态检查
```bash
# 检查服务状态
curl http://localhost:3000/feishu/status

# 检查健康状态
curl http://localhost:3000/api/health
```

### 3. ngrok 状态检查
```bash
# 检查 ngrok 隧道状态
curl http://localhost:4040/api/tunnels
```

## 📝 测试记录模板

### 测试记录表

| 测试项目 | 测试内容 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|---------|------|
| 普通消息 | 发送"你好" | 机器人接收 | | ⏳ |
| 斜杠指令 | /help | 显示帮助 | | ⏳ |
| 状态查询 | /status | 显示状态 | | ⏳ |
| 消息回应 | 点赞操作 | 接收回应事件 | | ⏳ |
| 用户事件 | 新用户加入 | 接收用户事件 | | ⏳ |

## 🚨 常见问题排查

### 1. 机器人无响应
**可能原因**：
- 事件订阅配置错误
- 公网地址不可访问
- 服务未正常运行

**排查步骤**：
```bash
# 检查服务状态
curl http://localhost:3000/api/health

# 检查 ngrok 状态
curl http://localhost:4040/api/tunnels

# 检查飞书服务状态
curl http://localhost:3000/feishu/status
```

### 2. 消息接收失败
**可能原因**：
- 权限配置不足
- 事件订阅未正确配置
- 网络连接问题

**排查步骤**：
- 检查飞书开发者后台的事件订阅配置
- 确认机器人权限设置
- 查看服务器错误日志

### 3. 指令不工作
**可能原因**：
- 指令处理逻辑错误
- 权限不足
- 消息格式问题

**排查步骤**：
- 检查指令处理代码
- 确认机器人有发送消息权限
- 查看指令处理日志

## 🎯 成功标准

### 基础功能
- [ ] 机器人能正常接收群组消息
- [ ] 斜杠指令能正常响应
- [ ] 消息回应事件能正常处理
- [ ] 用户事件能正常接收

### 高级功能
- [ ] 评论推送功能正常
- [ ] 回复功能正常
- [ ] 错误处理机制正常
- [ ] 性能表现良好

## 📞 技术支持

如果遇到问题，请：
1. 检查服务器日志
2. 确认服务状态
3. 验证飞书配置
4. 查看错误信息

---

**测试时间**：_____________
**测试人员**：_____________
**测试环境**：飞书群组
**服务地址**：https://2f7cfc2a4732.ngrok-free.app
